import{y as T,R as M,j as e,C as L,D as O,a as $,B as f,b as A,c as S,d as B,e as V,s as x,E as h,T as z,G as K,H as q,J as W,L as Q,K as X,I as Y,z as m,u as G,t as J,N as U,O as Z,P as ee,Q as se,U as ae,F as te,k as P,l as D,m as N,n as F,V as re,o as ne,W as oe,X as le,Y as ie,Z as ce,v as de,M as ue,_ as me,$ as xe,w as ge,x as he}from"./index-B8FHcfP5.js";import{I as pe,a as je,D as fe,b as ve,P as ye,l as Ce,m as be,C,c as y,d as we,e as Se,f as Pe,u as De,g as Ne,s as Fe,h as ke,i as Te,j as Me,k as Le}from"./use-dialog-state-DHFUo1nY.js";import{L as Ie,C as He}from"./confirm-dialog-BZAlBjPT.js";/**
 * @license @tabler/icons-react v3.26.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Re=T("outline","circle-plus","IconCirclePlus",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M9 12h6",key:"svg-1"}],["path",{d:"M12 9v6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.26.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var I=T("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);const H=[{value:"created",label:"Created",icon:Re},{value:"active",label:"Active",icon:pe},{value:"disabled",label:"Disabled",icon:je}],R=M.createContext(null);function _e({children:s,value:a}){return e.jsx(R.Provider,{value:a,children:s})}const Ee=()=>{const s=M.useContext(R);if(!s)throw new Error("useProxyManagersContext has to be used within <ProxyManagersListContextProvider.Provider>");return s};function Oe({row:s}){const a=L(),{setOpen:t,setCurrentRow:n}=Ee();return e.jsxs(O,{modal:!1,children:[e.jsx($,{asChild:!0,children:e.jsxs(f,{variant:"ghost",className:"flex text-right h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(A,{align:"end",className:"w-[160px]",children:[e.jsx(S,{onClick:()=>a.navigate({to:"/proxy-manager/$id/$nav",params:{id:s.original.id,nav:"overview"}}),children:"Edit"}),e.jsx(B,{}),e.jsxs(S,{onClick:()=>{n(s.original),t("delete")},children:["Delete",e.jsx(V,{children:e.jsx(ve,{size:16})})]})]})]})}function $e({children:s,className:a="",contentClassName:t=""}){const n=x.useRef(null),[d,l]=x.useState(!1);return x.useEffect(()=>{if(Ae(n.current)){l(!0);return}l(!1)},[]),d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(z,{delayDuration:0,children:e.jsxs(K,{children:[e.jsx(q,{asChild:!0,children:e.jsx("div",{ref:n,className:h("truncate",a),children:s})}),e.jsx(W,{children:e.jsx("p",{className:t,children:s})})]})})}),e.jsx("div",{className:"sm:hidden",children:e.jsxs(ye,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx("div",{ref:n,className:h("truncate",a),children:s})}),e.jsx(be,{className:h("w-fit",t),children:e.jsx("p",{children:s})})]})})]}):e.jsx("div",{ref:n,className:h("truncate",a),children:s})}const Ae=s=>s?s.offsetHeight<s.scrollHeight||s.offsetWidth<s.scrollWidth:!1,Be=[{id:"select",meta:{className:h("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},header:({table:s})=>e.jsx(C,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(C,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"domains",enableSorting:!1,header:({column:s})=>e.jsx(y,{column:s,title:"Domains"}),meta:{className:h("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1,cell:({row:s})=>{const a=s.original.domains;return e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem] gap-2",children:e.jsx(Q,{to:"/proxy-manager/$id/$nav",params:{id:s.original.id,nav:"overview"},children:a.map((t,n)=>e.jsx(X,{variant:"outline",children:t},n))})})})}},{accessorKey:"status",header:({column:s})=>e.jsx(y,{column:s,title:"Status"}),cell:({row:s})=>{const a=H.find(t=>t.value===s.getValue("status"));return a?e.jsxs("div",{className:"flex w-[100px] items-center",children:[a.icon&&e.jsx(a.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.label})]}):null},filterFn:(s,a,t)=>t.includes(s.getValue(a))},{accessorKey:"ssl",header:({column:s})=>e.jsx(y,{column:s,title:"SSL Keys"}),cell:({row:s})=>e.jsx($e,{children:s.original.ssl??"none"})},{id:"actions",cell:({row:s})=>e.jsx(Oe,{row:s})}];function Ve({table:s}){var t;const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Y,{placeholder:"Filter domain...",value:((t=s.getColumn("domains"))==null?void 0:t.getFilterValue())??"",onChange:n=>{var d;return(d=s.getColumn("domains"))==null?void 0:d.setFilterValue(n.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsx("div",{className:"flex gap-x-2",children:s.getColumn("status")&&e.jsx(we,{column:s.getColumn("status"),title:"Status",options:H})}),a&&e.jsxs(f,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Se,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Pe,{table:s})]})}const ze=m.object({domains:m.array(m.object({label:m.string(),value:m.string()})).min(1,{message:"One domain name is required."}),host:m.string().min(1,{message:"Host is required."}),protocol:m.string().min(1,{message:"Protocol is required."}),enableSSL:m.boolean()});function Ke({open:s,onOpenChange:a}){const[t,n]=x.useState(!1),d=L(),[l,g]=x.useState(null),u=G({resolver:J(ze),defaultValues:{domains:[],host:"",protocol:"http",enableSSL:!0}}),p=i=>{n(!0),ie(i).then(c=>c.data).then(({error:c,data:j})=>{c?(g(c.message),n(!1)):(j.id&&(u.reset(),a(!1),d.navigate({to:"/proxy-manager/$id/$nav",params:{id:j.id,nav:"overview"}})),n(!1))}).catch(c=>{g((c==null?void 0:c.message)??"An error occurred"),n(!1)})};return e.jsx(U,{open:s,onOpenChange:i=>{u.reset(),a(i)},children:e.jsxs(Z,{className:"sm:max-w-lg",children:[e.jsxs(ee,{className:"text-left",children:[e.jsx(se,{children:"Add new Proxy Host"}),e.jsx(ae,{children:l&&e.jsx("p",{className:"text-red-500",children:l})})]}),e.jsx(te,{...u,children:e.jsxs("form",{id:"user-form",onSubmit:u.handleSubmit(p),className:"space-y-2 p-0.5",children:[e.jsx(P,{control:u.control,name:"domains",render:({field:i})=>e.jsxs(D,{children:[e.jsx(N,{className:"col-span-2 text-right",children:"Domain Names"}),e.jsx(F,{children:e.jsx(re,{isMulti:!0,placeholder:"Enter Domain Names",...i})}),e.jsx(ne,{className:"col-span-4 col-start-3"})]})}),e.jsx(oe,{control:u.control,protocolProps:{},hostProps:{}}),e.jsx("div",{children:e.jsx(P,{control:u.control,name:"enableSSL",render:({field:i})=>e.jsxs(D,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 shadow",children:[e.jsx(F,{children:e.jsx(C,{checked:i.value,onCheckedChange:i.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(N,{children:"This feature will generalte self SSL certificates."})})]})})})]})}),e.jsx(le,{children:e.jsxs(f,{type:"submit",form:"user-form",disabled:t,children:[t&&e.jsx(Ie,{className:"animate-spin"})," Create Host ",e.jsx(I,{})]})})]})})}const k={title:"Proxy Hosts List",bareadcrumb:[{name:"Home",href:"/"},{name:"Proxy Hosts List"}]},qe=({id:s})=>{var w;const{toast:a}=ce(),[t,n]=x.useState(null),[d,l]=De(null),[g,u]=x.useState([]),{filters:p,pagination:i,setFilters:c}=Ne(s),j=Fe(p.sortBy),{isLoading:_,error:v,data:o,refetch:E}=de({queryKey:["proxyHostList",p],queryFn:()=>xe(p).then(r=>r.data),placeholderData:ge}),b=ke({columns:Be,state:{pagination:i,sorting:j,columnFilters:g},data:(o==null?void 0:o.data)??[],manualFiltering:!0,manualSorting:!0,manualPagination:!0,onColumnFiltersChange:u,getCoreRowModel:Te(),onPaginationChange:r=>{c(typeof r=="function"?r(i):r)},onSortingChange:r=>{c({sortBy:Me(typeof r=="function"?r(j):r)})},pageCount:(o==null?void 0:o.pageCount)??-1,rowCount:o==null?void 0:o.rowCount});return x.useEffect(()=>{console.log(g)},[g]),e.jsxs(_e,{value:{open:d,setOpen:l,currentRow:t,setCurrentRow:n},children:[e.jsxs(ue,{loading:_,error:(v==null?void 0:v.message)??((w=o==null?void 0:o.error)==null?void 0:w.message),title:k.title,bareadcrumb:k.bareadcrumb,rightComponent:e.jsxs(f,{className:"space-x-1",onClick:()=>l("create"),children:[e.jsx("span",{children:"Add Proxy"})," ",e.jsx(I,{size:18})]}),children:[e.jsx(Ve,{table:b}),e.jsx(Le,{table:b})]}),e.jsx(Ke,{open:d==="create",onOpenChange:()=>l("create")},"proxymanager-create"),t&&e.jsx(e.Fragment,{children:e.jsx(He,{destructive:!0,open:d==="delete",onOpenChange:()=>{l("delete"),setTimeout(()=>{n(null)},500)},handleConfirm:()=>{me({id:t.id}).then(r=>r.data).then(({error:r})=>{r?a({variant:"destructive",title:`Internal Server Error: ! ${r==null?void 0:r.message}`}):(a({variant:"default",title:"Deleted Successfully",description:"The proxy host has been deleted successfully."}),n(null),l(null),E())}).catch(r=>{a({variant:"destructive",title:`Internal Server Error: ! ${r==null?void 0:r.message}`})})},className:"max-w-md",title:`Delete this Proxy Host: ${t.domains.length>0?t.domains[0]:t.id} ?`,desc:e.jsxs(e.Fragment,{children:["You are about to delete a Proxy Host with the ID "," ",e.jsx("strong",{children:t.id}),". ",e.jsx("br",{}),"This action cannot be undone."]}),confirmText:"Delete"},"proxymanager-delete")})]})},Ye=he("/_authenticated/proxy-manager/")({component:qe});export{Ye as Route};
