import{y as B,R as H,j as e,a4 as T,D as O,a as z,B as j,b as V,c as b,d as q,e as K,H as N,C as v,a5 as X,a6 as Y,I as Q,z as x,s as p,u as W,t as Z,W as G,X as J,Y as U,Z as ee,_ as se,F as ae,k as F,l as k,m as L,n as I,$ as te,o as ne,a7 as oe,a0 as re,a8 as le,E as ie,v as ce,M as de,a9 as ue,aa as me,ab as xe,w as ge,x as he}from"./index-D6FmMTvM.js";import{D as pe,I as je,a as y,C as fe,b as Ce,u as be,c as ye,s as ve,d as we,g as Se,e as Pe,f as De}from"./use-dialog-state-BStcso-z.js";import{I as Ne,a as Fe,D as ke}from"./data-table-faceted-filter-CiEBsVyH.js";import{L as Le,I as R}from"./long-text-DbX7zpkV.js";import{L as Ie,C as Me}from"./confirm-dialog-BqHcj-me.js";/**
 * @license @tabler/icons-react v3.26.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var He=B("outline","circle-plus","IconCirclePlus",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M9 12h6",key:"svg-1"}],["path",{d:"M12 9v6",key:"svg-2"}]]);const _=[{value:"created",label:"Created",icon:He},{value:"active",label:"Active",icon:Ne},{value:"disabled",label:"Disabled",icon:Fe}],E=H.createContext(null);function Te({children:s,value:a}){return e.jsx(E.Provider,{value:a,children:s})}const Re=()=>{const s=H.useContext(E);if(!s)throw new Error("useProxyManagersContext has to be used within <ProxyManagersListContextProvider.Provider>");return s};function _e({row:s,table:a}){var l;const t=T(),{setOpen:o,setCurrentRow:u}=Re();return e.jsxs(O,{modal:!1,children:[e.jsx(z,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"flex text-right h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(V,{align:"end",className:"w-[160px]",children:[e.jsx(b,{onClick:()=>t.navigate({to:"/proxy-manager/$id/$nav",params:{id:s.original.id,nav:"overview"}}),children:"Edit"}),e.jsx(b,{onClick:()=>{const{handleChangeStatus:m}=a.options.meta,{id:i,status:g}=s.original;m&&m(i,g=="active"?"disable":"enable")},children:((l=s.original)==null?void 0:l.status)=="active"?"Disable":"Enable"}),e.jsx(q,{}),e.jsxs(b,{onClick:()=>{u(s.original),o("delete")},children:["Delete",e.jsx(K,{children:e.jsx(je,{size:16})})]})]})]})}const Ee=[{id:"select",meta:{className:N("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},header:({table:s})=>e.jsx(v,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(v,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"domains",enableSorting:!1,header:({column:s})=>e.jsx(y,{column:s,title:"Domains"}),meta:{className:N("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1,cell:({row:s})=>{const a=s.original.domains;return e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem] gap-2",children:e.jsx(X,{to:"/proxy-manager/$id/$nav",params:{id:s.original.id,nav:"overview"},children:a.map((t,o)=>e.jsx(Y,{variant:"outline",children:t},o))})})})}},{accessorKey:"status",header:({column:s})=>e.jsx(y,{column:s,title:"Status"}),cell:({row:s})=>{const a=_.find(t=>t.value===s.getValue("status"));return a?e.jsxs("div",{className:"flex w-[100px] items-center",children:[a.icon&&e.jsx(a.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.label})]}):null},filterFn:(s,a,t)=>t.includes(s.getValue(a))},{accessorKey:"ssl",header:({column:s})=>e.jsx(y,{column:s,title:"SSL Keys"}),cell:({row:s})=>{var a,t;return e.jsx(Le,{children:((t=(a=s.original)==null?void 0:a.ssl)==null?void 0:t.type)??"none"})}},{id:"actions",cell:({row:s,table:a})=>e.jsx(_e,{row:s,table:a})}];function $e({table:s}){var t;const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Q,{placeholder:"Filter domain...",value:((t=s.getColumn("domains"))==null?void 0:t.getFilterValue())??"",onChange:o=>{var u;return(u=s.getColumn("domains"))==null?void 0:u.setFilterValue(o.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsx("div",{className:"flex gap-x-2",children:s.getColumn("status")&&e.jsx(ke,{column:s.getColumn("status"),title:"Status",options:_})}),a&&e.jsxs(j,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(fe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Ce,{table:s})]})}const Ae=x.object({domains:x.array(x.object({label:x.string(),value:x.string()})).min(1,{message:"One domain name is required."}),host:x.string().min(1,{message:"Host is required."}),protocol:x.string().min(1,{message:"Protocol is required."}),enableSSL:x.boolean()});function Be({open:s,onOpenChange:a}){const[t,o]=p.useState(!1),u=T(),[l,m]=p.useState(null),i=W({resolver:Z(Ae),defaultValues:{domains:[],host:"",protocol:"http",enableSSL:!0}}),g=c=>{o(!0),le(c).then(d=>d.data).then(({error:d,data:h})=>{d?(m(d.message),o(!1)):(h.id&&(i.reset(),a(!1),u.navigate({to:"/proxy-manager/$id/$nav",params:{id:h.id,nav:"overview"}})),o(!1))}).catch(d=>{m((d==null?void 0:d.message)??"An error occurred"),o(!1)})};return e.jsx(G,{open:s,onOpenChange:c=>{i.reset(),a(c)},children:e.jsxs(J,{className:"sm:max-w-lg",children:[e.jsxs(U,{className:"text-left",children:[e.jsx(ee,{children:"Add new Proxy Host"}),e.jsx(se,{children:l&&e.jsx("p",{className:"text-red-500",children:l})})]}),e.jsx(ae,{...i,children:e.jsxs("form",{id:"user-form",onSubmit:i.handleSubmit(g),className:"space-y-2 p-0.5",children:[e.jsx(F,{control:i.control,name:"domains",render:({field:c})=>e.jsxs(k,{children:[e.jsx(L,{className:"col-span-2 text-right",children:"Domain Names"}),e.jsx(I,{children:e.jsx(te,{isMulti:!0,placeholder:"Enter Domain Names",...c})}),e.jsx(ne,{className:"col-span-4 col-start-3"})]})}),e.jsx(oe,{control:i.control,protocolProps:{},hostProps:{}}),e.jsx("div",{children:e.jsx(F,{control:i.control,name:"enableSSL",render:({field:c})=>e.jsxs(k,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 shadow",children:[e.jsx(I,{children:e.jsx(v,{checked:c.value,onCheckedChange:c.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(L,{children:"This feature will generalte self SSL certificates."})})]})})})]})}),e.jsx(re,{children:e.jsxs(j,{type:"submit",form:"user-form",disabled:t,children:[t&&e.jsx(Ie,{className:"animate-spin"})," Create Host ",e.jsx(R,{})]})})]})})}const M={title:"Proxy Hosts List",bareadcrumb:[{name:"Home",href:"/"},{name:"Proxy Hosts List"}]},Oe=({id:s})=>{var P;const{toast:a}=ie(),[t,o]=p.useState(null),[u,l]=be(null),[m,i]=p.useState([]),{filters:g,pagination:c,setFilters:d}=ye(s),h=ve(g.sortBy),{isLoading:$,error:f,data:r,refetch:w}=ce({queryKey:["proxyHostList",g],queryFn:()=>xe(g).then(n=>n.data),placeholderData:ge}),A=(n,D)=>{me({id:n,status:D}).then(C=>C.data).then(()=>{a({title:"Success",description:D=="disable"?"Proxy host disabled":"Proxy host enabled"}),w()}).catch(C=>{a({title:"Error",description:C.message,variant:"destructive"})})},S=we({columns:Ee,state:{pagination:c,sorting:h,columnFilters:m},data:(r==null?void 0:r.data)??[],manualFiltering:!0,manualSorting:!0,manualPagination:!0,onColumnFiltersChange:i,getCoreRowModel:Se(),onPaginationChange:n=>{d(typeof n=="function"?n(c):n)},onSortingChange:n=>{d({sortBy:Pe(typeof n=="function"?n(h):n)})},pageCount:(r==null?void 0:r.pageCount)??-1,rowCount:r==null?void 0:r.rowCount,meta:{handleChangeStatus:A}});return p.useEffect(()=>{console.log(m)},[m]),e.jsxs(Te,{value:{open:u,setOpen:l,currentRow:t,setCurrentRow:o},children:[e.jsxs(de,{loading:$,error:(f==null?void 0:f.message)??((P=r==null?void 0:r.error)==null?void 0:P.message),title:M.title,bareadcrumb:M.bareadcrumb,rightComponent:e.jsxs(j,{className:"space-x-1",onClick:()=>l("create"),children:[e.jsx("span",{children:"Add Proxy"})," ",e.jsx(R,{size:18})]}),children:[e.jsx($e,{table:S}),e.jsx(De,{table:S})]}),e.jsx(Be,{open:u==="create",onOpenChange:()=>l("create")},"proxymanager-create"),t&&e.jsx(e.Fragment,{children:e.jsx(Me,{destructive:!0,open:u==="delete",onOpenChange:()=>{l("delete"),setTimeout(()=>{o(null)},500)},handleConfirm:()=>{ue({id:t.id}).then(n=>n.data).then(({error:n})=>{n?a({variant:"destructive",title:`Internal Server Error: ! ${n==null?void 0:n.message}`}):(a({variant:"default",title:"Deleted Successfully",description:"The proxy host has been deleted successfully."}),o(null),l(null),w())}).catch(n=>{a({variant:"destructive",title:`Internal Server Error: ! ${n==null?void 0:n.message}`})})},className:"max-w-md",title:`Delete this Proxy Host: ${t.domains.length>0?t.domains[0]:t.id} ?`,desc:e.jsxs(e.Fragment,{children:["You are about to delete a Proxy Host with the ID "," ",e.jsx("strong",{children:t.id}),". ",e.jsx("br",{}),"This action cannot be undone."]}),confirmText:"Delete"},"proxymanager-delete")})]})},Ye=he("/_authenticated/proxy-manager/")({component:Oe});export{Ye as Route};
